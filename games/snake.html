<div class="card">
  <button class="back-btn" onclick="backMenu()">←</button>
  <canvas id="game" width="420" height="420"></canvas>
  <div style="display:flex;gap:12px;align-items:center;margin-top:10px;">
    <button id="btn-start">▶</button>
    <button id="btn-restart">⟲</button>
    <span id="score">0</span>
    <select id="skin">
      <option value="#8fd14f">🟩</option>
      <option value="#48b9e9">🟦</option>
      <option value="#e94e77">🟥</option>
      <option value="#f7e94e">🟨</option>
    </select>
  </div>
</div>
<script>
  function backMenu() {
    document.getElementById('game-container').innerHTML = '';
    document.getElementById('menu').style.display = '';
  }
  const c = document.getElementById('game');
  const ctx = c.getContext('2d');
  const size = 22, cell = c.width / size;
  let snake, dir, food, running, score, tickId, skin, speed;
  function randCell() { return Math.floor(Math.random() * size); }
  function reset() {
    snake = [{x:11,y:11}];
    dir = {x:1,y:0};
    food = spawnFood();
    running = false;
    score = 0;
    speed = 85;
    skin = document.getElementById('skin').value;
    document.getElementById('score').textContent = score;
    draw();
  }
  function spawnFood() {
    let f;
    do { f = {x: randCell(), y: randCell()}; }
    while (snake.some(s => s.x===f.x && s.y===f.y));
    return f;
  }
  function step() {
    if (!running) return;
    speed = Math.max(35, 85 - score*2);
    clearInterval(tickId); tickId = setInterval(step, speed);
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
    head.x = (head.x + size) % size; head.y = (head.y + size) % size;
    if (snake.some((s,i)=> i && s.x===head.x && s.y===head.y)) {
      running = false; drawGameOver(); return;
    }
    snake.unshift(head);
    if (head.x === food.x && head.y === food.y) {
      score++; document.getElementById('score').textContent = score;
      food = spawnFood();
    } else { snake.pop(); }
    draw();
  }
  function draw() {
    ctx.fillStyle = '#191e29'; ctx.fillRect(0,0,c.width,c.height);
    ctx.strokeStyle = '#232b3d'; ctx.lineWidth = 1;
    for (let i=0;i<=size;i++){
      ctx.beginPath(); ctx.moveTo(i*cell,0); ctx.lineTo(i*cell,c.height); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0,i*cell); ctx.lineTo(c.width,i*cell); ctx.stroke();
    }
    ctx.fillStyle = '#e94e77'; ctx.fillRect(food.x*cell, food.y*cell, cell, cell);
    ctx.fillStyle = skin;
    snake.forEach((s,i)=>{
      ctx.globalAlpha = 1-i*0.04;
      ctx.fillRect(s.x*cell, s.y*cell, cell, cell);
      ctx.globalAlpha = 1;
    });
  }
  function drawGameOver(){
    draw();
    ctx.fillStyle = 'rgba(0,0,0,0.49)';
    ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 26px system-ui, Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Game Over', c.width/2, c.height/2);
  }
  function start(){
    if (running) return;
    running = true; clearInterval(tickId);
    tickId = setInterval(step, speed);
  }
  function restart(){ reset(); start(); }
  document.getElementById('btn-start').onclick = start;
  document.getElementById('btn-restart').onclick = restart;
  document.getElementById('skin').onchange = () => { skin = document.getElementById('skin').value; draw(); };
  window.addEventListener('keydown', e=>{
    const k = e.key.toLowerCase();
    if (k==='arrowup' || k==='w') { if (dir.y===0) dir={x:0,y:-1}; }
    if (k==='arrowdown' || k==='s') { if (dir.y===0) dir={x:0,y:1}; }
    if (k==='arrowleft' || k==='a') { if (dir.x===0) dir={x:-1,y:0}; }
    if (k==='arrowright' || k==='d') { if (dir.x===0) dir={x:1,y:0}; }
    if (k==='r') restart();
    if (k===' ') running ? running=false : start();
    if (k==='escape') backMenu();
  });
  reset();
</script>